services:
  hillium-forge:
    container_name: hillium-forge
    build:
      context: ../..
      dockerfile: infrastructure/docker/Dockerfile.forge
      args:
        USER_ID: ${USER_ID:-1000}
        GROUP_ID: ${GROUP_ID:-1000}
    platform: linux/arm64

    volumes:
      # Live code mount
      - ../..:/workspace
      # Cargo caches (CRITICAL - preserve these)
      - hillium-forge-cargo-cache:/usr/local/cargo/registry
      - hillium-forge-cargo-git:/usr/local/cargo/git
      - hillium-forge-target:/workspace/target

    networks:
      - hillium-net

    stdin_open: true
    tty: true

    working_dir: /workspace

volumes:
  hillium-forge-cargo-cache:
  hillium-forge-cargo-git:
  hillium-forge-target:


networks:
  hillium-net:
    external: true
